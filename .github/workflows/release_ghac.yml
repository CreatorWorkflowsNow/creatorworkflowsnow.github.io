name: "Release PDF GHAC"

on:
  push:
    branches:
      - source

jobs:
  build_and_push:
    name: Build and Push Container
    runs-on: ubuntu-latest

    steps:
      - name: "☁️ Checkout Repository"
        uses: actions/checkout@v2
      
      - name: "🔧 Set up Docker Buildx"
        uses: docker/setup-buildx-action@v1

      - name: "🔧 Set up Node.js"
        uses: actions/setup-node@v2
        with:
          node-version: 18

      - name: "🔧 Install npm@latest"
        run: npm install -g npm@latest

      - name: "📦 Build and Push Docker Image"
        uses: docker/build-push-action@v2
        with:
          context: .
          dockerfile: ./Dockerfile 
          tags: ${{ github.repository }}:${{ github.sha }}
          labels: |
            org.opencontainers.image.description=Creator Workflows Workshop Lab Guides
            org.opencontainers.image.source=https://github.com/CreatorWorkflowsNow/CreatorWorkflowsNow.github.io
          push: true

  release:
    name: Semantic release
    needs:
      - build_and_push
    runs-on: ubuntu-latest

    steps:
      - name: "☁️ Checkout Repository"
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: "🚀 Release"
        uses: docker://ghcr.io/open-sauced/semantic-release-conventional-config:3.0.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
